/// @generated by the sqlc-gen-rust on sqlc-generate using sqlc.yaml
/// DO NOT EDIT.
use postgres::{Error, Row};
const LIST_CITIES: &str = r#"
select slug, name
from city
order by name
"#;
const GET_CITY: &str = r#"
select slug, name
from city
where slug = $1
"#;
const CREATE_CITY: &str = r#"
INSERT INTO city (
    name,
    slug
) VALUES (
    $1,
    $2
) RETURNING slug, name
"#;
const UPDATE_CITY_NAME: &str = r#"
UPDATE city
SET name = $2
WHERE slug = $1
"#;
const LIST_VENUES: &str = r#"
SELECT id, status, statuses, slug, name, city, spotify_playlist, songkick_id, tags, created_at
FROM venue
WHERE city = $1
ORDER BY name
"#;
const DELETE_VENUE: &str = r#"
DELETE FROM venue
WHERE slug = $1 AND slug = $1
"#;
const GET_VENUE: &str = r#"
SELECT id, status, statuses, slug, name, city, spotify_playlist, songkick_id, tags, created_at
FROM venue
WHERE slug = $1 AND city = $2
"#;
const CREATE_VENUE: &str = r#"
INSERT INTO venue (
    slug,
    name,
    city,
    created_at,
    spotify_playlist,
    status,
    statuses,
    tags
) VALUES (
    $1,
    $2,
    $3,
    NOW(),
    $4,
    $5,
    $6,
    $7
) RETURNING id
"#;
const UPDATE_VENUE_NAME: &str = r#"
UPDATE venue
SET name = $2
WHERE slug = $1
RETURNING id
"#;
const VENUE_COUNT_BY_CITY: &str = r#"
SELECT
    city,
    count(*)
FROM venue
GROUP BY 1
ORDER BY 1
"#;
#[derive(Debug, Display, postgres_types::ToSql, postgres_type::FromSql)]
pub enum Status {
    #[postgres(name = "op!en")]
    Open,
    #[postgres(name = "clo@sed")]
    Closed,
}
#[derive(Clone, Debug, sqlc_derive::FromPostgresRow, PartialEq)]
pub(crate) struct City {
    pub slug: String,
    pub name: String,
}
#[derive(Clone, Debug, sqlc_derive::FromPostgresRow, PartialEq)]
pub(crate) struct CreateCityParams {
    pub name: String,
    pub slug: String,
}
#[derive(Clone, Debug, sqlc_derive::FromPostgresRow, PartialEq)]
pub(crate) struct CreateVenueParams {
    pub slug: String,
    pub name: String,
    pub city: String,
    pub spotify_playlist: String,
    pub status: Status,
    pub statuses: Option<Vec<Status>>,
    pub tags: Option<Vec<String>>,
}
#[derive(Clone, Debug, sqlc_derive::FromPostgresRow, PartialEq)]
pub(crate) struct GetVenueParams {
    pub slug: String,
    pub city: String,
}
#[derive(Clone, Debug, sqlc_derive::FromPostgresRow, PartialEq)]
pub(crate) struct UpdateCityNameParams {
    pub slug: String,
    pub name: String,
}
#[derive(Clone, Debug, sqlc_derive::FromPostgresRow, PartialEq)]
pub(crate) struct UpdateVenueNameParams {
    pub slug: String,
    pub name: String,
}
#[derive(Clone, Debug, sqlc_derive::FromPostgresRow, PartialEq)]
pub(crate) struct Venue {
    pub id: i32,
    pub status: Status,
    pub statuses: Option<Vec<Status>>,
    pub slug: String,
    pub name: String,
    pub city: String,
    pub spotify_playlist: String,
    pub songkick_id: Option<String>,
    pub tags: Option<Vec<String>>,
    pub created_at: String,
}
#[derive(Clone, Debug, sqlc_derive::FromPostgresRow, PartialEq)]
pub(crate) struct VenueCountByCityRow {
    pub city: String,
    pub count: i64,
}
pub struct Queries {
    client: postgres::Client,
}
impl Queries {
    pub fn new(client: postgres::Client) -> Self {
        Self { client }
    }
    pub(crate) fn create_city(&mut self, arg: CreateCityParams) -> anyhow::Result<City> {
        let row = self.client.query_one(CREATE_CITY, &[&arg.name, &arg.slug])?;
        Ok(sqlc_core::FromPostgresRow::from_row(&row)?)
    }
    pub(crate) fn create_venue(
        &mut self,
        arg: CreateVenueParams,
    ) -> anyhow::Result<i32> {
        let row = self
            .client
            .query_one(
                CREATE_VENUE,
                &[
                    &arg.slug,
                    &arg.name,
                    &arg.city,
                    &arg.spotify_playlist,
                    &arg.status,
                    &arg.statuses,
                    &arg.tags,
                ],
            )?;
        Ok(sqlc_core::FromPostgresRow::from_row(&row)?)
    }
    pub(crate) fn delete_venue(&mut self, slug: String) -> anyhow::Result<()> {
        self.client.execute(DELETE_VENUE, &[&slug])?;
        Ok(())
    }
    pub(crate) fn get_city(&mut self, slug: String) -> anyhow::Result<City> {
        let row = self.client.query_one(GET_CITY, &[&slug])?;
        Ok(sqlc_core::FromPostgresRow::from_row(&row)?)
    }
    pub(crate) fn get_venue(&mut self, arg: GetVenueParams) -> anyhow::Result<Venue> {
        let row = self.client.query_one(GET_VENUE, &[&arg.slug, &arg.city])?;
        Ok(sqlc_core::FromPostgresRow::from_row(&row)?)
    }
    pub(crate) fn list_cities(&mut self) -> anyhow::Result<Vec<City>> {
        let rows = self.client.query(LIST_CITIES, &[])?;
        let mut result: Vec<City> = vec![];
        for row in rows {
            result.push(sqlc_core::FromPostgresRow::from_row(&row)?);
        }
        Ok(result)
    }
    pub(crate) fn list_venues(&mut self, city: String) -> anyhow::Result<Vec<Venue>> {
        let rows = self.client.query(LIST_VENUES, &[&city])?;
        let mut result: Vec<Venue> = vec![];
        for row in rows {
            result.push(sqlc_core::FromPostgresRow::from_row(&row)?);
        }
        Ok(result)
    }
    pub(crate) fn update_city_name(
        &mut self,
        arg: UpdateCityNameParams,
    ) -> anyhow::Result<()> {
        self.client.execute(UPDATE_CITY_NAME, &[&arg.slug, &arg.name])?;
        Ok(())
    }
    pub(crate) fn update_venue_name(
        &mut self,
        arg: UpdateVenueNameParams,
    ) -> anyhow::Result<i32> {
        let row = self.client.query_one(UPDATE_VENUE_NAME, &[&arg.slug, &arg.name])?;
        Ok(sqlc_core::FromPostgresRow::from_row(&row)?)
    }
    pub(crate) fn venue_count_by_city(
        &mut self,
    ) -> anyhow::Result<Vec<VenueCountByCityRow>> {
        let rows = self.client.query(VENUE_COUNT_BY_CITY, &[])?;
        let mut result: Vec<VenueCountByCityRow> = vec![];
        for row in rows {
            result.push(sqlc_core::FromPostgresRow::from_row(&row)?);
        }
        Ok(result)
    }
}
