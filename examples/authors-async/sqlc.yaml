version: "2"
plugins:
  - name: rust-gen
    env:
      - RUST_BACKTRACE
      - RUST_LOG
    wasm:
      url: file://./../../target/wasm32-wasip1/release/sqlc-gen.wasm
      sha256: 2fa592006e7c94f5617b7e77c6f696432273c22480ff3455f260b5c02096ee27
# - name: js
#   process:
#     cmd: sqlc-gen-json
sql:
  - schema: postgresql/migrations/
    queries: postgresql/query.sql
    engine: postgresql
    codegen:
      - out: src/db
        plugin: rust-gen
        options:
          use_async: true
          use_deadpool: false
          rules:
            - type: '*'
              derive:
                # - postgres_derive::ToSql
                # - postgres_derive::FromSql
                - serde::Serialize
                - serde::Deserialize
                - Clone
                - Debug
                - PartialEq
                # - type: enums
                #   derive:
                #     - Eq
                #   container:
                #     - '#[serde(rename_all = "SCREAMING_SNAKE_CASE")]'
                #     # variants:
                #     #   - "I"
                # - type: TypeGenre
                #   derive:
                #     - Hash
                #   # container:
                #   #   - ""
                #   variants:
                #     # "*":
                #     #   - "something for all variants"
                #     - name: history
                #       attributes:
                #         - '#[serde(rename = "HISTORY_NEW")]'
                # - type: structs
                #   # derive:
                #   #   - Eq
                #   # container: 
                #   #   - "something"
                #   fields:
                #     - name: name
                #       attributes:
                #         - '#[serde(skip)]'
                # - type: Author
                #   derive:
                #     - Hash
                #   # container: 
                #   #   - "#[serde(default)]"
                #   fields:
                #     - name: '*'
                #       attributes:
                #         - '#[serde(default)]'
                #     - name: id
                #       attributes:
                #         - '#[serde(skip)]'
# - out: gen
#   plugin: js
