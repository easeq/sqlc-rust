version: "2"
plugins:
  - name: rust-gen
    env:
      - RUST_BACKTRACE
      - RUST_LOG
    wasm:
      url: file://./../../target/wasm32-wasip1/release/sqlc-gen.wasm
      sha256: e8f095f56c5fd9791518dbf2163e164e5e7bed456cf5da72d7fbb306291342d4
# - name: js
#   process:
#     cmd: sqlc-gen-json
sql:
  - schema: postgresql/migrations/
    queries: postgresql/query.sql
    engine: postgresql
    codegen:
      - out: src/db
        plugin: rust-gen
        options:
          use_async: true
          use_deadpool: false
          rules:
            - type: '*'
              # exclude: 
              #   - TypeGenre
              derive:
                # - postgres_derive::ToSql
                # - postgres_derive::FromSql
                - serde::Serialize
                - serde::Deserialize
                - Clone
                - Debug
                - PartialEq
            # - type: enums
            #   # exclude: 
            #   #   - TypeGenre
            #   derive:
            #     - Eq
            #   container:
            #     - '#[serde(rename_all = "SCREAMING_SNAKE_CASE")]'
            #     # variants:
            #     #   - "I"
            # - type: TypeGenre
            #   derive:
            #     - Hash
            #   # container:
            #   #   - ""
            #   variants:
            #     # "*":
            #     #   - "something for all variants"
            #     - name: history
            #       attributes:
            #         - '#[serde(rename = "HISTORY_NEW")]'
            # - type: structs
            #   # exclude: 
            #   #   - Author
            #   # derive:
            #   #   - Eq
            #   # container: 
            #   #   - "something"
            #   fields:
            #     - name: name
            #       attributes:
            #         - '#[serde(skip)]'
            # - type: Author
            #   derive:
            #     - Hash
            #   # container: 
            #   #   - "#[serde(default)]"
            #   fields:
            #     - name: '*'
            #       attributes:
            #         - '#[serde(default)]'
            #     - name: id
            #       attributes:
            #         - '#[serde(skip)]'
# - out: gen
#   plugin: js
